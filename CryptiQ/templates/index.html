<!DOCTYPE html>
<html>
<head>
    <title>CryptiQ - Cipher Breaker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% include 'base_nav.html' %}

    <div class="container">
        <h2>Cipher Breaker</h2>

        <form id="breaker-form">
            <label for="cipher_type" class="cipher-label">Select Cipher:</label>
            <select name="cipher_type" id="cipher_type">
                <option value="affine" selected>Affine</option>
                <option value="amsco">AMSCO</option>
                <option value="caesar">Caesar</option>
                <option value="columnar">Columnar Transposition</option>
                <option value="permutation">Permutation (Block  Transposition)</option>
                <option value="polybius">Polybius Square</option>
                <option value="railfence">Railfence</option>
                <option value="substitution">Monoalphabetic Substitution</option>
                <option value="vigenere">Vigen√®re</option>


            </select>

            <textarea name="text" placeholder="Enter ciphertext to break" required></textarea>
            <button type="submit" id="break-btn">Break Cipher</button>

            <div id="loading" class="loading-overlay" style="display:none;">
                <div class="spinner"></div>
                <p>Breaking cipher...</p>
            </div>
        </form>

        <h2>Result:</h2>
        <p id="result-key"></p>
        <button id="copy-btn" style="display:none; margin-bottom: 10px;">Copy to Clipboard</button>
        <pre id="result-text"></pre>
    </div>

    <script>
        const form = document.getElementById("breaker-form");
        const button = document.getElementById("break-btn");
        const loading = document.getElementById("loading");
        const resultText = document.getElementById("result-text");
        const resultKey = document.getElementById("result-key");
        const copyBtn = document.getElementById("copy-btn");

        form.addEventListener("submit", async function(e) {
            e.preventDefault();
            button.style.display = "none";
            loading.style.display = "flex";

            const formData = new FormData(form);
            const response = await fetch("/", { method: "POST", body: formData });
            const data = await response.json();

            loading.style.display = "none";
            button.style.display = "inline-block";

            resultKey.textContent = data.key ? `Key: ${data.key}` : "";
            resultText.textContent = data.text || "";
            copyBtn.style.display = data.text ? "inline-block" : "none";
        });

        copyBtn.addEventListener("click", () => {
            navigator.clipboard.writeText(resultText.textContent);
            copyBtn.textContent = "Copied!";
            setTimeout(() => copyBtn.textContent = "Copy to Clipboard", 2000);
        });
    </script>
</body>
</html>
