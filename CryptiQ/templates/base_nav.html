<nav class="navbar">
  <div class="nav-left">
    <div class="nav-logo">CryptiQ</div>
  </div>

  <!-- Hamburger -->
  <button class="hamburger" id="hamburger" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>

  <ul class="nav-items" id="nav-menu">
    <li><a href="{{ url_for('index') }}">Cipher Breaker</a></li>
    <li><a href="{{ url_for('tools_page') }}">Tools</a></li>
    <li><a href="{{ url_for('info_page') }}">Info</a></li>
    <li><a href="{{ url_for('posts_list') }}">Posts</a></li>

    {% if user %}
      <li><a href="{{ url_for('posts_new') }}">New Post</a></li>
      <li><a href="{{ url_for('logout') }}">Logout</a></li>
      <li class="nav-username">{{ user['username'] }}</li>
    {% else %}
      <li><a href="{{ url_for('login') }}">Login</a></li>
      <li><a href="{{ url_for('register') }}">Register</a></li>
    {% endif %}

    <li class="nav-theme">
      <button id="theme-toggle" aria-label="Toggle theme" title="Toggle theme">
        <span id="theme-toggle-icon" aria-hidden="true">🌙</span>
        <span id="theme-toggle-text">Dark</span>
      </button>
    </li>
  </ul>
</nav>

<style>
/* === NAVBAR === */
.navbar {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 68px;
  display: flex; align-items: center;
  background: rgba(18, 18, 18, 0.8);
  backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding: 0 28px;
  z-index: 1000;
}

.nav-logo {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--accent, #00ffd5);
}

.nav-items {
  display: flex;
  list-style: none;
  margin-left: auto;
  gap: 28px;
  align-items: center;
}

.nav-items li a {
  color: var(--text, #f0f0f0);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s ease;
}
.nav-items li a:hover {
  color: var(--accent, #00ffd5);
}

/* === THEME TOGGLE === */
#theme-toggle {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  border: 1px solid var(--line, #333);
  border-radius: 8px;
  background: transparent;
  color: var(--text, #f0f0f0);
  cursor: pointer;
  transition: background 0.2s ease, border-color 0.2s ease;
}
#theme-toggle:hover {
  background: rgba(0,255,213,0.12);
  border-color: rgba(0,255,213,0.4);
}

/* === HAMBURGER BUTTON === */
.hamburger {
  display: none;
  position: absolute;
  right: 20px;
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.12);
  border-radius: 50%;
  width: 44px; height: 44px;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  gap: 5px;
  cursor: pointer;
  transition: all 0.3s ease;
}
.hamburger:hover {
  background: rgba(0,255,213,0.15);
  border-color: rgba(0,255,213,0.45);
  box-shadow: 0 0 10px rgba(0,255,213,0.3);
}
.hamburger span {
  width: 20px; height: 2px;
  background: var(--text, #fff);
  border-radius: 2px;
  transition: all 0.3s ease;
}
.hamburger.open span:nth-child(1) {
  transform: translateY(7px) rotate(45deg);
}
.hamburger.open span:nth-child(2) {
  opacity: 0;
}
.hamburger.open span:nth-child(3) {
  transform: translateY(-7px) rotate(-45deg);
}

/* === MOBILE NAV MENU === */
@media (max-width: 900px) {
  .hamburger { display: flex; }

  .nav-items {
    position: fixed;
    top: 68px;
    right: -100%;
    flex-direction: column;
    align-items: flex-start;
    background: rgba(18,18,18,0.85);
    backdrop-filter: blur(10px);
    border-left: 1px solid rgba(255,255,255,0.08);
    width: 240px;
    height: calc(100vh - 68px);
    padding: 24px;
    gap: 18px;
    box-shadow: -6px 0 25px rgba(0,0,0,0.4);
    transition: right 0.35s ease;
  }

  .nav-items.open {
    right: 0;
  }

  .nav-items li a {
    font-size: 1rem;
    padding: 8px 0;
    width: 100%;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .nav-theme {
    margin-top: auto;
    width: 100%;
  }
}
</style>

<script>
  // === MOBILE MENU TOGGLE ===
  const burger = document.getElementById("hamburger");
  const menu = document.getElementById("nav-menu");

  burger.addEventListener("click", () => {
    burger.classList.toggle("open");
    menu.classList.toggle("open");
  });

  document.addEventListener("click", (e) => {
    if (!menu.contains(e.target) && !burger.contains(e.target)) {
      menu.classList.remove("open");
      burger.classList.remove("open");
    }
  });

  // === THEME TOGGLE ===
  (function () {
    const STORAGE_KEY = "cryptiq.theme";
    const root = document.documentElement;
    const btn = document.getElementById("theme-toggle");
    const icon = document.getElementById("theme-toggle-icon");
    const label = document.getElementById("theme-toggle-text");

    const getSystem = () =>
      window.matchMedia("(prefers-color-scheme: light)").matches
        ? "light"
        : "dark";
    const saved = localStorage.getItem(STORAGE_KEY);
    const theme = saved || getSystem();
    apply(theme);

    function apply(t) {
      if (t === "light") root.setAttribute("data-theme", "light");
      else root.removeAttribute("data-theme");
      const isLight = root.getAttribute("data-theme") === "light";
      icon.textContent = isLight ? "☀️" : "🌙";
      label.textContent = isLight ? "Light" : "Dark";
    }

    btn.addEventListener("click", () => {
      const current = root.getAttribute("data-theme");
      const next = current === "light" ? "dark" : "light";
      apply(next);
      localStorage.setItem(STORAGE_KEY, next);
    });

    window
      .matchMedia("(prefers-color-scheme: light)")
      .addEventListener("change", (e) => {
        if (!localStorage.getItem(STORAGE_KEY))
          apply(e.matches ? "light" : "dark");
      });
  })();
</script>
